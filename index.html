<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Pneus – Borracharia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f2f2;padding:15px}
h1{text-align:center}
.card{background:#fff;border-radius:10px;padding:15px;margin-bottom:15px}
button{padding:10px;border:none;border-radius:6px;cursor:pointer}
.btn{background:#16a34a;color:#fff}
.btn-sec{background:#6b7280;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
input,select,textarea{width:100%;padding:8px;margin-bottom:10px}
.hidden{display:none}
.tabs{display:flex;gap:5px;margin-bottom:10px}
.tab{flex:1;padding:10px;background:#e5e7eb;text-align:center;border-radius:8px;font-weight:bold;cursor:pointer}
.tab.active{background:#16a34a;color:#fff}
.aba{border-left:4px solid #16a34a;padding-left:10px}
.foto-box{display:flex;gap:10px;flex-wrap:wrap}
.foto-box img{width:120px;height:120px;object-fit:cover;border-radius:8px}
</style>
</head>

<body>

<h1>Controle de Pneus</h1>

<div class="card">
  <label>Mês</label>
  <select id="mesSel">
    <option value="01">Janeiro</option><option value="02">Fevereiro</option>
    <option value="03">Março</option><option value="04">Abril</option>
    <option value="05">Maio</option><option value="06">Junho</option>
    <option value="07">Julho</option><option value="08">Agosto</option>
    <option value="09">Setembro</option><option value="10">Outubro</option>
    <option value="11">Novembro</option><option value="12">Dezembro</option>
  </select>

  <label>Ano</label>
  <select id="anoSel"></select>

  <button class="btn" onclick="criarMes()">Abrir / Criar</button>
</div>

<div id="lista" class="card hidden">
  <button class="btn" onclick="novaAvaliacao()">➕ Nova Avaliação</button>
  <div id="avaliacoes"></div>
</div>

<div id="form" class="card hidden">
  <h3>Avaliação do Pneu</h3>

  <div class="tabs">
    <div class="tab active" onclick="abrirAba(0)">Dados</div>
    <div class="tab" onclick="abrirAba(1)">Motivo</div>
    <div class="tab" onclick="abrirAba(2)">Informações</div>
    <div class="tab" onclick="abrirAba(3)">Fotos</div>
    <div class="tab" onclick="abrirAba(4)">Observação</div>
  </div>

  <div class="aba">
    <input id="marca" placeholder="Marca">
    <input id="medida" placeholder="Medida">
    <select id="status"><option>Ativo</option><option>Sucateado</option></select>
  </div>

  <div class="aba hidden">
    <select id="desenho"><option>Liso</option><option>Borrachudo</option><option>Misto</option></select>
    <input id="profundidade" placeholder="Profundidade">
    <input id="vida" type="number" placeholder="Vida %">
  </div>

  <div class="aba hidden">
    <input id="numero" placeholder="Número do pneu">
    <input id="veiculo" placeholder="Veículo">
  </div>

  <div class="aba hidden">
    <input type="file" multiple accept="image/*" onchange="carregarFotos(event)">
    <div class="foto-box" id="fotos"></div>
  </div>

  <div class="aba hidden">
    <textarea id="obs" placeholder="Observações"></textarea>
  </div>

  <button class="btn" onclick="salvar()">Salvar</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
apiKey: "AIzaSyDIUS5Z_2e_V3qwzvTOxPzH2O5QRPCGcGM",
  authDomain: "controle-de-pneus-cmc.firebaseapp.com",
  projectId: "controle-de-pneus-cmc",
  storageBucket: "controle-de-pneus-cmc.appspot.com",
  messagingSenderId: "947294126166",
  appId: "1:947294126166:web:ea857f0e12a46a99053bf7"
});

const db = firebase.firestore();
const storage = firebase.storage();

let mesAtual=null, avaliacoes=[], editando=null, arquivosTemp=[];

const anoSel=document.getElementById('anoSel');
for(let a=2023;a<=2035;a++) anoSel.innerHTML+=`<option>${a}</option>`;

async function criarMes(){
  mesAtual = `${anoSel.value}-${mesSel.value}`;
  const snap = await db.collection('avaliacoes_pneus').doc(mesAtual).collection('itens').get();
  avaliacoes=[];
  snap.forEach(d=>avaliacoes.push({id:d.id,...d.data()}));
  lista.classList.remove('hidden');
  render();
}

function render(){
  const el=document.getElementById('avaliacoes');
  el.innerHTML='';
  avaliacoes.forEach((a,i)=>{
    el.innerHTML+=`<div class='card'><b>${a.marca}</b><br>
    <button class='btn' onclick='editar(${i})'>Editar</button></div>`;
  });
}

function novaAvaliacao(){
  editando=null; arquivosTemp=[]; fotos.innerHTML='';
  form.classList.remove('hidden');
}

function carregarFotos(e){
  [...e.target.files].forEach(f=>{
    arquivosTemp.push(f);
    const r=new FileReader();
    r.onload=()=>{const img=document.createElement('img');img.src=r.result;fotos.appendChild(img)}
    r.readAsDataURL(f);
  });
}

async function salvar(){
  const ref=db.collection('avaliacoes_pneus').doc(mesAtual).collection('itens');
  const doc=editando?ref.doc(editando):ref.doc();
  const urls=[];
  for(const f of arquivosTemp){
    const p=`pneus/${mesAtual}/${doc.id}/${Date.now()}_${f.name}`;
    const s=await storage.ref(p).put(f);
    urls.push(await s.ref.getDownloadURL());
  }
  await doc.set({
    marca:marca.value,medida:medida.value,status:status.value,
    desenho:desenho.value,profundidade:profundidade.value,
    vida:vida.value,numero:numero.value,veiculo:veiculo.value,
    obs:obs.value,fotos:urls,criadoEm:new Date()
  });
  form.classList.add('hidden');
  criarMes();
}

function editar(i){editando=avaliacoes[i].id}
function abrirAba(i){
  document.querySelectorAll('.tab').forEach((t,x)=>t.classList.toggle('active',x===i));
  document.querySelectorAll('.aba').forEach((a,x)=>a.classList.toggle('hidden',x!==i));
}
</script>

</body>
</html>
